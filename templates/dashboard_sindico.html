{% extends 'base.html' %}
{% block content %}

<h3 class="mb-4">Painel do S√≠ndico</h3>

<!-- CONTROLE DE M√äS -->

<div class="row mb-4">
    <div class="col-md-8 mx-auto">

        <div class="card shadow-sm">
            <div class="card-body">

                <div class="d-flex justify-content-center align-items-center gap-3 flex-wrap">

                    <!-- M√äS ANTERIOR -->
                    <a href="?mes={{ mes_anterior }}"
                       class="btn btn-outline-secondary">
                        ‚Üê M√™s anterior
                    </a>

                    <!-- SELETOR -->
                    <form method="get" class="d-flex align-items-center gap-2">

                        <input type="month"
                               name="mes"
                               value="{{ mes_selecionado }}"
                               class="form-control"
                               style="max-width: 180px;">

                        <button type="submit"
                                class="btn btn-primary">
                            Ir
                        </button>
                    </form>

                    <!-- PR√ìXIMO M√äS -->
                    <a href="?mes={{ mes_proximo }}"
                       class="btn btn-outline-secondary">
                        Pr√≥ximo m√™s ‚Üí
                    </a>

                </div>

            </div>
        </div>

    </div>
</div>

<!-- CARDS PRINCIPAIS -->

<div class="row mb-4">

    <div class="col-md-4">
        <div class="card text-bg-primary text-center shadow-sm">
            <div class="card-body">
                <h2>{{ total_condominio }} kg</h2>
                <p>Total do Condom√≠nio (m√™s)</p>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card text-bg-success text-center shadow-sm">
            <div class="card-body">
                <h4>üèÜ Res√≠duo Campe√£o</h4>
                <h5>{{ residuo_campeao }}</h5>
                <p>{{ total_campeao }} kg</p>
            </div>
        </div>
    </div>

</div>

<!-- GR√ÅFICOS -->

<div class="row mb-4">

    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header">Distribui√ß√£o por Tipo</div>
            <div class="card-body">
                <canvas id="graficoResiduos"></canvas>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header">Ranking de Blocos</div>
            <div class="card-body">
                <canvas id="graficoBlocos"></canvas>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header">Ranking Total de Unidades</div>
            <div class="card-body">
                <canvas id="graficoUnidades"></canvas>
            </div>
        </div>
    </div>

</div>

<!-- TABELAS DE RANKING -->

<div class="row">

    <!-- RANKING BLOCO -->
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header">Ranking de Blocos</div>
            <div class="card-body">
                <table class="table table-striped align-middle">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Bloco</th>
                            <th>Kg</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in ranking_blocos %}
                        <tr>
                            <td>
                                {% if forloop.counter == 1 %}ü•á
                                {% elif forloop.counter == 2 %}ü•à
                                {% elif forloop.counter == 3 %}ü•â
                                {% else %}{{ forloop.counter }}{% endif %}
                            </td>
                            <td>{{ item.morador__profile__unidade__bloco__nome }}</td>
                            <td><strong>{{ item.total }}</strong></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- RANKING TOTAL UNIDADES -->
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header">Ranking Total de Unidades</div>
            <div class="card-body">
                <table class="table table-striped align-middle">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Unidade</th>
                            <th>Kg</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in ranking_unidades %}
                        <tr>
                            <td>
                                {% if forloop.counter == 1 %}ü•á
                                {% elif forloop.counter == 2 %}ü•à
                                {% elif forloop.counter == 3 %}ü•â
                                {% else %}{{ forloop.counter }}{% endif %}
                            </td>
                            <td>
                                {{ item.morador__profile__unidade__bloco__nome }} -
                                {{ item.morador__profile__unidade__numero }}
                            </td>
                            <td><strong>{{ item.total }}</strong></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- RANKING POR BLOCO AGRUPADO -->
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header">Ranking de Unidades por Bloco</div>
            <div class="card-body">

                {% for bloco, unidades in ranking_unidades_por_bloco.items %}
                    <h6 class="mt-3">{{ bloco }}</h6>
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Unidade</th>
                                <th>Kg</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in unidades %}
                            <tr>
                                <td>
                                    {% if forloop.counter == 1 %}ü•á
                                    {% elif forloop.counter == 2 %}ü•à
                                    {% elif forloop.counter == 3 %}ü•â
                                    {% else %}{{ forloop.counter }}{% endif %}
                                </td>
                                <td>{{ item.morador__profile__unidade__numero }}</td>
                                <td>{{ item.total }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% endfor %}

            </div>
        </div>
    </div>

</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>

new Chart(document.getElementById('graficoResiduos'), {
    type: 'doughnut',
    data: {
        labels: {{ residuos_labels|safe }},
        datasets: [{
            data: {{ residuos_valores|safe }},
            backgroundColor: [
                '#36A2EB','#FF6384','#4BC0C0',
                '#9966FF','#FFCE56','#C9CBCF'
            ]
        }]
    }
});

new Chart(document.getElementById('graficoBlocos'), {
    type: 'bar',
    data: {
        labels: {{ blocos_labels|safe }},
        datasets: [{
            data: {{ blocos_valores|safe }},
            backgroundColor: 'rgba(54,162,235,0.7)'
        }]
    },
    options: { indexAxis: 'y', plugins: { legend: { display: false } } }
});

new Chart(document.getElementById('graficoUnidades'), {
    type: 'bar',
    data: {
        labels: {{ unidades_labels|safe }},
        datasets: [{
            data: {{ unidades_valores|safe }},
            backgroundColor: 'rgba(255,159,64,0.7)'
        }]
    },
    options: { plugins: { legend: { display: false } } }
});

</script>
{% endblock %}